<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="format-detection" content="telphone=no, email=no"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="keywords" th:content="${blog.type.name}"/>
    <meta name="description" th:content="${blog.description}"/>
    <title th:text="${blog.title}">博客详情</title>
    <link rel="shortcut icon" href="../static/img/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="../static/css/typo.css" th:href="@{/css/typo.css}"/>
    <link rel="stylesheet" href="../static/css/animate.min.css" th:href="@{/css/animate.min.css}"/>
    <link rel="stylesheet" href="../static/css/prism.css" th:href="@{/css/prism.css}"/>
    <link rel="stylesheet" href="../static/lib/tocbot/tocbot.css" th:href="@{/lib/tocbot/tocbot.css}"/>
    <link rel="stylesheet" href="../static/css/nav-left.css" th:href="@{/css/nav-left.css}">
    <style>
        #live2dcanvas {
            border: 0 !important;
        }
    </style>
</head>
<body>
<!-- 头部 -->
<nav class="ui attached segment parent-left-style diy-shadow" style="background: rgba(0,0,0,0.7) !important;">
    <div class="ui container">
        <div class="ui inverted secondary menu stackable">
            <h3 class="ui olive header item">Zm-Mmm</h3>
            <a href="#" th:href="@{/}" class="flag item diy-mobile blue">首页</a>
            <a href="#" th:href="@{/types/-1}" class="flag item diy-mobile blue">分类</a>
            <a href="#" th:href="@{/tags/-1}" class="flag item diy-mobile blue">标签</a>
            <a href="#" th:href="@{/archives}" class="flag item diy-mobile blue">归档</a>
            <a href="#" th:href="@{/leavingmessage}" class="flag item diy-mobile blue">留言</a>
            <a href="#" th:href="@{/about}" class="flag item diy-mobile blue">关于我</a>
            <div class="right flag item diy-mobile">
                <form name="search" action="#" th:action="@{/search}" method="post" target="_blank">
                    <div class="ui icon inverted input transparent">
                        <input type="text" name="query" placeholder="搜索博客" th:value="${query}"/>
                        <i onclick="document.forms['search'].submit()" class="search link icon"></i>
                    </div>
                </form>
            </div>
            <a href="#" class="ui index menu black icon button diy-button-top-right diy-button-show item">
                <i class="sidebar icon"></i>
            </a>
        </div>
    </div>

</nav>
<!-- 中间 -->
<div class="diy-padding-big diy-container animated bounceInUp">
    <div class="ui container">
        <!-- 头部 -->
        <div class="ui top attached segment center aligned">

            <div class="ui horizontal link list">
                <div class="item">
                    <img src="https://unsplash.it/100/100?image=1005" th:src="@{${blog.user.avatar}}" alt=""
                         class="ui avatar image" style="margin-bottom: 3px">
                    <div class="content" style="margin-bottom: 3px">
                        <a href="#" th:href="@{/about}" class="header" th:text="${blog.user.nickname}">Zm-Mmm</a>
                    </div>
                </div>
                <div class="item">
                    <div class="middle aligned">
                        <i class="calendar icon"></i><span th:text="${#dates.format(blog.updateTime,'yyyy-MM-dd')}">2020-7-3</span>
                    </div>
                </div>
                <div class="item">
                    <div class="middle aligned">
                        <i class="eye icon"></i><span th:text="${blog.views}">233</span>
                    </div>
                </div>
                <div class="item">
                    <a href="#" th:href="@{/types/{id}(id=${blog.type.id})}" class="ui blue basic label padding-mini"
                       target="_blank" th:text="${blog.type.name}">Java</a>
                </div>
            </div>


        </div>
        <!-- 图片 -->
        <div class="ui attached segment">
            <img src="https://unsplash.it/800/450?image=1005" th:src="@{${blog.firstPicture}}" alt=""
                 class="ui fluid image">
        </div>
        <!-- 内容 -->
        <div class="ui attached segment">
            <!-- 右侧标签 -->
            <div class="ui right aligned basic segment">
                <div class="ui orange basic label" th:text="${blog.flag}">原创</div>
            </div>

            <h2 class="ui center aligned header" th:text="${blog.title}">标题</h2>
            <!-- 文章主体 -->

                <div id="content" class="typo typo-selection js-toc-content diy-padding-left-right diy-padding-large">
                    <div th:utext="${blog.content}"></div>

                </div>

            <!-- 底部标签 -->
            <div class="diy-padding-left-right">
                <div class="ui basic blue up pointing label " th:each="tag : ${blog.tags}" th:text="${tag.name}">
                    Java
                </div>
            </div>

            <!-- 打赏 -->
            <div th:if="${blog.appreciation}">
                <div class="ui center aligned basic segment">
                    <button class="ui orange basic circular button" id="clickButton">赞赏</button>
                </div>
                <div class="ui clickShow flowing popup transition hidden">

                    <div class="ui images" style="font-size: inherit !important;">
                        <div class="image">
                            <img src="../static/img/支付宝收款码.png" th:src="@{/img/支付宝收款码.png}" alt=""
                                 class="ui rounded bordered image" style="width: 150px;">
                            <div>支付宝</div>
                        </div>
                        <div class="image">
                            <img src="../static/img/微信收款码.png" th:src="@{/img/微信收款码.png}" alt=""
                                 class="ui rounded bordered image" style="width: 150px;">
                            <div>微信</div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- 博客信息 -->
        <div class="ui attached cool-background diy-padding-left-right-big diy-padding-large" th:if="${blog.shareStatement}">
            <div class="ui middle aligned grid">
                <div class="eleven wide column text-row-spacing text-spacing text-fine2">
                    <ui class="list">
                        <li style="list-style: none;">作者: <a href="#" th:href="@{/about}" target="_blank"><span th:text="${blog.user.nickname}">Zm-Mmm</span> </a></li>
                        <li style="list-style: none;">更新时间: <span
                                th:text="${#dates.format(blog.updateTime,'yyyy-MM-dd HH:mm:ss')}">2020-7-4</span></li>
                        <li style="list-style: none;">发布时间: <span
                                th:text="${#dates.format(blog.createTime,'yyyy-MM-dd HH:mm:ss')}">2020-7-4</span></li>
                        <li style="list-style: none;">转载请在文末添加原创文章出处</li>
                    </ui>
                </div>
                <div class="five wide column">
                    <img src="../static/img/文末声明表情包.jpg" th:src="@{/img/文末声明表情包.jpg}" alt=""
                         class="ui right floated rounded bordered image" style="width: 110px;">
                </div>
            </div>
        </div>
        <!-- 评论 -->
        <div class="ui bottom attached segment" id="bindId" th:if="${blog.comment}">
            <!-- 列表 -->
            <div class="ui blue segment" id="comment-container">
                <div th:fragment="commentList">
                    <div class="ui threaded comments" style="max-width: 100%;">
                        <h3 class="ui dividing header">评论</h3>
                        <div class="comment" th:each="comment : ${comments}">
                            <a class="avatar">
                                <img src="https://unsplash.it/100/100?image=1005" th:src="@{${comment.avatar}}">
                            </a>
                            <div class="content">
                                <a class="author">
                                    <span th:text="${comment.nickname}">Matt</span>
                                    <div class="ui mini basic blue left pointing label padding-mini"
                                         th:if="${comment.adminComment}">创作者
                                    </div>
                                </a>
                                <div class="metadata">
                                    <span class="date"
                                          th:text="${#dates.format(comment.createTime,'yyyy-MM-dd HH:mm')}">今天下午 5:42</span>
                                </div>
                                <div class="text" th:text="${comment.content}">太赞了！</div>
                                <div class="actions">
                                    <a class="reply" data-commentid="1" data-commentnickname="Matt"
                                       th:attr="data-commentid=${comment.id},data-commentnickname=${comment.nickname}"
                                       onclick="reply(this)">回复</a>
                                </div>
                            </div>
                            <!--第一级的子级-->
                            <div class="comments" th:if="${#arrays.length(comment.replyComments)}>0">
                                <div class="comment" th:each="reply : ${comment.replyComments}">
                                    <a class="avatar">
                                        <img src="https://unsplash.it/100/100?image=1005" th:src="@{${reply.avatar}}">
                                    </a>
                                    <div class="content">
                                        <a class="author">
                                            <span th:text="${reply.nickname}">小红</span>
                                            <div class="ui mini basic blue left pointing label padding-mini"
                                                 th:if="${reply.adminComment}">创作者
                                            </div>
                                            &nbsp;<span th:text="|@ ${reply.parentComment.nickname}|"
                                                        style="color: gray;">@ 小白</span>
                                        </a>
                                        <div class="metadata">
                                            <span class="date"
                                                  th:text="${#dates.format(reply.createTime,'yyyy-MM-dd HH:mm')}">Today at 5:42PM</span>
                                        </div>
                                        <div class="text" th:text="${reply.content}">
                                            How artistic!
                                        </div>
                                        <div class="actions">
                                            <a class="reply" data-commentid="1" data-commentnickname="Matt"
                                               th:attr="data-commentid=${reply.id},data-commentnickname=${reply.nickname}"
                                               onclick="reply(this)">回复</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 提交 -->
            <div class="ui form" id="comment-form">
                <input type="hidden" name="blog.id" th:value="${blog.id}">
                <input type="hidden" name="parentComment.id" value="-1">
                <div class="field">
                    <textarea name="content" placeholder="请输入评论"></textarea>
                </div>
                <div class="fields">
                    <div class="field diy-margin-bottom diy-mobile-wide">
                        <div class="ui left icon input">
                            <i class="user icon"></i>
                            <input type="text" placeholder="姓名" name="nickname"
                                   th:value="${session.user}!=null ? ${session.user.nickname}"/>
                        </div>
                    </div>
                    <div class="field diy-margin-bottom diy-mobile-wide">
                        <div class="ui left icon input">
                            <i class="mail icon"></i>
                            <input type="text" placeholder="邮箱" name="email"
                                   th:value="${session.user}!=null ? ${session.user.email}"/>
                        </div>
                    </div>
                    <div class="field diy-mobile-wide">
                        <button class="ui green button diy-mobile-wide" type="button" id="commentpost-btn"><i
                                class="edit icon"></i>发布
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 右侧滚动工具栏 -->
<div class="ui vertical icon buttons diy-fixed">
    <button type="button" class="ui blue rightmenu button diy-mobile">目录</button>
    <div id="ly-button" class="ui blue button" th:if="${blog.comment}">评论</div>
    <button class="ui mobileBrowsing icon button diy-mobile"><i class="large mobile alternate icon"></i></button>
    <div id="top-button" class="ui button"><i class="large chevron up icon"></i></div>
</div>

<!-- 预留生成目录位置 -->
<div class="ui menu-show flowing popup transition hidden" style="width: 350px;padding-right: 50px;">
    <ol class="js-toc">

    </ol>
</div>

<!-- 二维码弹出框 -->
<div id="ewm" class="ui qrcodes flowing popup transition hidden" style="width: 128px !important;"></div>

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

<!-- 底部 -->
<footer class="ui vertical segment diy-padding-big" style="background: rgba(0,0,0,0.7) !important;">
    <div class="ui container">
        <div class="ui inverted divided stackable grid middle aligned center aligned">
            <div class="four wide column">
                <h4 class="ui inverted header text-spacing text-fine">提交您的宝贵意见</h4>
                <a href="#" th:href="@{/leavingmessage}" onclick="alert('邮件服务器暂未启用，请前往留言页面')">
                    <div class="ui blue button"><i class="mail icon"></i>发送邮件</div>
                </a>
            </div>

            <div class="eight wide column">
                <h4 class="ui inverted header text-spacing text-fine text-opacity2" style="margin-bottom: 1em">
                    <img src="../static/img/点赞.png" th:src="@{/img/点赞.png}" class="ui image padding-mini"
                         style="margin-bottom: 0.7em !important;" onclick="countNumber()">
                    <span id="countspan"></span><br>
                    总访问人数
                    <span th:text="${count}" style="color:#11fff8;"></span>
                    今日访客数
                    <span th:text="${mannum}" style="color: #11fff8;"></span>
                    <br>
                    <div class="diy-margin-small">
                        网站已苟活了
                        <span id="run_time" style="color:white;"></span><br>
                    </div>
                    <span style="color:white;">Copyright © 2020 Zm-Mmm All rights reserved.</span>

                </h4>

            </div>

            <div class="four wide column">

                <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1456133139&amp;site=qq&amp;menu=yes"
                   target="_blank">
                    <div class="circular ui icon button blue">
                        <i class="icon large qq"></i>
                    </div>
                </a>
                <a href="./img/wechat.png" target="_blank"
                   onclick="window.open(this.href,'','width=255,height=255,top=400,left=788');return false">
                    <div class="circular ui icon button green">
                        <i class="icon large wechat"></i>
                    </div>
                </a>
                <a href="https://gitee.com/zm_mmm" target="_blank">
                    <div class="circular ui icon button red">
                        <i class="icon large github"></i>
                    </div>
                </a>

            </div>
        </div>

    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.0.4/lib/L2Dwidget.min.js"></script>
<script src="../static/js/kbn.js" th:src="@{/js/kbn.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/jquery.scrollto@2.1.2/jquery.scrollTo.min.js"></script>
<script src="../static/js/prism.js" th:src="@{/js/prism.js}"></script>
<script src="../static/lib/tocbot/tocbot.min.js" th:src="@{/lib/tocbot/tocbot.min.js}"></script>
<script src="../static/js/qrcode.min.js" th:src="@{/js/qrcode.min.js}"></script>
<!--<script src="js/h5background.js" th:src="@{/js/h5background.js}"></script>-->
<script th:inline="javascript">
    // pre追加代码行号显示与自动换行
    $('pre').addClass("line-numbers").css("white-space", "pre-wrap");
    // 手机端菜单折叠
    $('.index').click(function () {
        $('.flag').toggleClass('diy-mobile');
    });

    // 打赏按钮
    $('#clickButton').popup({
        popup: $('.clickShow.popup'),
        on: 'click',
        position: 'bottom center'
    });

    // 初始化tocbot目录
    tocbot.init({
        // Where to render the table of contents.
        tocSelector: '.js-toc',
        // Where to grab the headings to build the table of contents.
        contentSelector: '.js-toc-content',
        // Which headings to grab inside of the contentSelector element.
        headingSelector: 'h1, h2, h3, h4, h5',
        // For headings inside relative or absolute positioned containers within content.
        hasInnerContainers: true,
    });
    $('.rightmenu').popup({
        popup: $('.menu-show.popup'),
        on: 'click',
        position: 'left center'
    });

    // 初始化二维码生成器
    var qrcode = new QRCode("ewm", {
        text: window.location.href,
        width: 128,
        height: 128,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
    });
    $('.mobileBrowsing').popup({
        popup: $('.qrcodes'),
        position: 'left center'
    });

    $('#top-button').click(function () {
        $(window).scrollTo(0, 500);
    });

    $('#ly-button').click(function () {
        $(window).scrollTo('#bindId', 500);
    });

    //评论表单验证
    $('.ui.form').form({
        fields: {
            content: {
                identifier: 'content',
                rules: [{
                    type: 'empty',
                    prompt: ''
                }]
            },
            nickname: {
                identifier: 'nickname',
                rules: [{
                    type: 'empty',
                    prompt: ''
                }]
            },
            email: {
                identifier: 'email',
                rules: [{
                    type: 'email',
                    prompt: ''
                }]
            }
        }
    });

    $(function () {
        $("#comment-container").load(/*[[@{/comments/{id}(id=${blog.id})}]]*/"comments/6");
    });


    $('#commentpost-btn').click(function () {
        var boo = $('.ui.form').form('validate form');
        if (boo) {
            console.log('校验成功');
            postData();
        } else {
            console.log('校验失败');
        }
    });

    function postData() {
        $("#comment-container").load(/*[[@{/comments}]]*/"", {
            "parentComment.id": $("[name='parentComment.id']").val(),
            "detail.id": $("[name='blog.id']").val(),
            "nickname": $("[name='nickname']").val(),
            "email": $("[name='email']").val(),
            "content": $("[name='content']").val()
        }, function (responseTxt, statusTxt, xhr) {
//        $(window).scrollTo($('#comment-container'),500);
            clearContent();
        });
    }

    function clearContent() {
        $("[name='content']").val('');
        $("[name='parentComment.id']").val(-1);
        $("[name='content']").attr("placeholder", "请输入评论");
    }


    function reply(obj) {
        var commentId = $(obj).data('commentid');
        var commentNickname = $(obj).data('commentnickname');
        $("[name='content']").attr("placeholder", "@" + commentNickname).focus();
        $("[name='parentComment.id']").val(commentId);
        $(window).scrollTo($('#comment-form'), 500);
    }

    // 时间统计
    function runTime() {
        let d = new Date(), str = '';
        BirthDay = new Date("July 08,2020");
        today = new Date();
        timeold = (today.getTime() - BirthDay.getTime());
        sectimeold = timeold / 1000;
        secondsold = Math.floor(sectimeold);
        msPerDay = 24 * 60 * 60 * 1000;
        msPerYear = 365 * 24 * 60 * 60 * 1000;
        e_daysold = timeold / msPerDay;
        e_yearsold = timeold / msPerYear;
        daysold = Math.floor(e_daysold);
        yearsold = Math.floor(e_yearsold);
        //str = yearsold + "年";
        str += daysold + "天";
        str += d.getHours() + '时';
        str += d.getMinutes() + '分';
        str += d.getSeconds() + '秒';
        return str;
    }

    setInterval(function () {
        $('#run_time').html(runTime())
    }, 1000);

    /**
     * 点赞计数
     */
    if (!localStorage.countAll) {

        localStorage.countAll = 0;
    }
    document.getElementById('countspan').innerHTML = localStorage.countAll;

    function countNumber() {
        localStorage.countAll++;
        document.getElementById('countspan').innerHTML = localStorage.countAll;
    }
</script>
</body>
</html>
